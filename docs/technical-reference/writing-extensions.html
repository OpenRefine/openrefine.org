<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-technical-reference/writing-extensions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Writing extensions | OpenRefine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openrefine.org/docs/technical-reference/writing-extensions"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Writing extensions | OpenRefine"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/openrefine_logo.svg"><link data-rh="true" rel="canonical" href="https://openrefine.org/docs/technical-reference/writing-extensions"><link data-rh="true" rel="alternate" href="https://openrefine.org/docs/technical-reference/writing-extensions" hreflang="en"><link data-rh="true" rel="alternate" href="https://openrefine.org/docs/technical-reference/writing-extensions" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RXJKLJKJU2-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenRefine RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenRefine Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="OpenRefine" href="/opensearch.xml">


<script src="/js/fix-location.js"></script><link rel="stylesheet" href="/assets/css/styles.a1181bf6.css">
<script src="/assets/js/runtime~main.3b2d2040.js" defer="defer"></script>
<script src="/assets/js/main.c6558953.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_hUDU" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/openrefine_logo.svg" alt="OpenRefine diamond logo" class="themedComponent_vVmS themedComponent--light_NniB"><img src="/img/openrefine_logo.svg" alt="OpenRefine diamond logo" class="themedComponent_vVmS themedComponent--dark_yJur"></div><b class="navbar__title text--truncate">OpenRefine</b></a><a class="navbar__item navbar__link" href="/download">Download</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/donate">Donate</a><a href="https://github.com/OpenRefine/OpenRefine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RpKI"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_CSJf colorModeToggle_Cgdy"><button class="clean-btn toggleButton_jrrp toggleButtonDisabled_v9ww" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_hPNs"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Pxog"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_WQyT"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_tDGm"><div class="docsWrapper_kJ9P"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_hEO2" type="button"></button><div class="docRoot_q0n7"><aside class="theme-doc-sidebar-container docSidebarContainer_HBrN"><div class="sidebarViewport_rCxN"><div class="sidebar_hGra"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Uy8J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs">User Manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/technical-reference/contributing">Contributing to OpenRefine</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/contributing">Getting started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/why-get-involved">Why get involved</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/github">Communicating via GitHub</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/technical-reference/code-contributions">Contributing as a developer</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/code-contributions">Code contributions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/translating-ui">Translate OpenRefine&#x27;s interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/build-test-run">How to build, test and run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/functional-tests">Functional tests</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/technical-reference/architecture-before-4">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/technical-reference/writing-extensions">Extensions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/technical-reference/writing-extensions">Writing extensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/migrating-older-extensions">Migrating older extensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/wikibase/architecture">Wikibase extension</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/technical-reference/maintainer-guidelines">Maintaining OpenRefine</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/technical-reference/introduction">Contributing as a designer</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/documentation-contributions">Documentation contributions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical-reference/development-roadmap">Development roadmap</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_msDC"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VluO"><div class="docItemContainer_z4Sv"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_WV5T" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xTv0"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Contributing to OpenRefine</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Contributing as a developer</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Extensions</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Writing extensions</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_d09M theme-doc-toc-mobile tocMobile__k1e"><button type="button" class="clean-btn tocCollapsibleButton_cV_m">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Writing extensions</h1></header><h2 class="anchor anchorWithStickyNavbar__YFU" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>This is a very brief overview of the structure of OpenRefine extensions. For more detailed documentation and step-by-step guides please see the following external documentation/tutorials:</p>
<ul>
<li>Giuliano Tortoreto has <a href="https://github.com/giTorto/OpenRefineExtensionDoc/raw/master/main.pdf" target="_blank" rel="noopener noreferrer">written documentation detailling how to build extension for OpenRefine</a></li>
<li>Owen Stephens has written <a href="http://www.meanboyfriend.com/overdue_ideas/2017/05/writing-an-extension-to-add-new-grel-functions-to-openrefine/" target="_blank" rel="noopener noreferrer">a guide to developing an extension which adds new GREL functions to OpenRefine</a>.</li>
</ul>
<p>OpenRefine makes use of a modified version of the <a href="https://github.com/OpenRefine/simile-butterfly/tree/openrefine" target="_blank" rel="noopener noreferrer">Butterfly framework</a> to provide an extension architecture. OpenRefine extensions are Butterfly modules. You don&#x27;t really need to know about Butterfly itself, but you might encounter &quot;butterfly&quot; here and there in the code base.</p>
<p>Extensions that come with the code base are located under <a href="https://github.com/OpenRefine/OpenRefine/tree/master/extensions" target="_blank" rel="noopener noreferrer">the extensions sub-directory</a>, but when you develop your own extension, you can put its code anywhere as long as you point Butterfly to it. That is done by any one of the following methods</p>
<ul>
<li>refer to your extension&#x27;s directory in <a href="https://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/WEB-INF/butterfly.properties" target="_blank" rel="noopener noreferrer">the butterfly.properties file</a> through a <code>butterfly.modules.path</code> setting.</li>
<li>specify the butterfly.modules.path property on the command line when you run OpenRefine. This overrides the values in the property file, so you need to include the default values first e.g. <code>-Dbutterfly.modules.path=modules,../../extensions,/path/to/your/extension</code></li>
</ul>
<p>Please note that you should bundle any dependencies yourself, so you are insulated from OpenRefine packaging changes over time.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="directory-layout">Directory Layout<a href="#directory-layout" class="hash-link" aria-label="Direct link to Directory Layout" title="Direct link to Directory Layout">​</a></h3>
<p>A OpenRefine extension sits in a file directory that contains the following files and sub-directories:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pom.xml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  src/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      com/foo/bar/... *.java source files</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      *.html, *.vt files</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      scripts/... *.js files</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      styles/... *.css files</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      images/... image files</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      MOD-INF/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          lib/*.jar files</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          classes/... java class files</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          module.properties</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          controller.js</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The file named <code>module.properties</code> (see <a href="https://github.com/OpenRefine/OpenRefine/blob/master/extensions/sample/module/MOD-INF/module.properties" target="_blank" rel="noopener noreferrer">example</a>) contains the extension&#x27;s metadata. Of importance is the name field, which gives the extension a name that&#x27;s used in many other places to refer to it. This can be different from the extension&#x27;s directory name.</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">name = my-extension-name</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Your extension&#x27;s client-side resources (.html, .js, .css files) stored in the <code>module/</code> sub-directory will be accessible from <a href="http://127.0.0.1:3333/extension/my-extension-name/" target="_blank" rel="noopener noreferrer">http://127.0.0.1:3333/extension/my-extension-name/</a> when OpenRefine is running.</p>
<p>Also of importance is the dependency</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">requires = core</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>which makes sure that the core module of OpenRefine is loaded before the extension attempts to hook into it.</p>
<p>The file named <code>controller.js</code> is responsible for registering the extension&#x27;s hooks into OpenRefine. Look at the sample-extension extension&#x27;s <a href="https://github.com/OpenRefine/OpenRefine/blob/master/extensions/sample/module/MOD-INF/controller.js" target="_blank" rel="noopener noreferrer">controller.js</a> file for an example. It should have a function called <code>init()</code> that does the hook registrations.</p>
<p>The <code>pom.xml</code> file is an <a href="http://maven.apache.org/" target="_blank" rel="noopener noreferrer">Apache Maven</a> build file. You can make a copy of the sample extension&#x27;s <code>pom.xml</code> file to get started. The important point here is that the Java classes should be built into the <code>module/MOD-INF/classes</code> sub-directory.</p>
<p>Note that your extension&#x27;s Java code would need to reference some libraries used in OpenRefine and OpenRefine&#x27;s Java classes themselves. These dependencies are reflected in the Maven configuration for the extension.</p>
<h2 class="anchor anchorWithStickyNavbar__YFU" id="sample-extension">Sample extension<a href="#sample-extension" class="hash-link" aria-label="Direct link to Sample extension" title="Direct link to Sample extension">​</a></h2>
<p>The sample extension is included in the code base so that you can copy it and get started on writing your own extension. After you copy it, make sure you change its name inside its <code>module/MOD-INF/controller.js</code> file.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="basic-structure">Basic Structure<a href="#basic-structure" class="hash-link" aria-label="Direct link to Basic Structure" title="Direct link to Basic Structure">​</a></h3>
<p>The sample extension&#x27;s code is in <code>refine/extensions/sample/</code>. In that directory, Java source code is contained under the <code>src</code> sub-directory, and webapp code is under the <code>module</code> sub-directory. Here is the full directory layout:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">refine/extensions/sample/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      build.xml (ant build script)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      src/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          com/google/refine/sampleExtension/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              ... Java source code ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      module/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          MOD-INF/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              module.properties (module settings)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              controller.js (module init and routing logic in Javascript)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          classes/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              ... compiled Java classes ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          lib/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              ... Java jars ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          ... velocity templates (.vt) ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          ... .css files ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          ... client-side files (.html, .css, .js, image files) ...</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The sub-directory <code>MOD-INF</code> contains the Butterfly module&#x27;s metadata and is what Butterfly looks for when it scans directories for modules. <code>MOD-INF</code> serves similar functions as <code>WEB-INF</code> in other web frameworks.</p>
<p>Java code is built into the sub-directory <code>classes</code> inside <code>MOD-INF</code>, and supporting external Java jars are in the <code>lib</code> sub-directory. Those will be automatically loaded by Butterfly. (The build.xml script is wired to compile into the <code>classes</code> sub-directory.)</p>
<p>Client-side code is in the inner <code>module</code> sub-directory. They can be plain old .html, .css, .js, and image files. There are also Velocity .vt files, but they need to be routed inside <code>MOD-INF/controller.js</code>.</p>
<p><code>MOD-INF/controller.js</code> lets you configure the extension&#x27;s initialization and URL routing in Javascript rather than in Java. For example, when the requested URL path is either <code>/</code> or an empty string, we process and return <code>MOD-INF/index.vt</code> ( <a href="http://127.0.0.1:3333/extension/sample/" target="_blank" rel="noopener noreferrer">see http://127.0.0.1:3333/extension/sample/</a> if OpenRefine is running).</p>
<p>The <code>init()</code> function in <code>controller.js</code> allows the extension to register various client-side handlers for augmenting pages served by Refine&#x27;s core. These handlers are feature-specific. For example, <a href="https://github.com/OpenRefine/OpenRefine/blob/master/extensions/jython/module/MOD-INF/controller.js#L46" target="_blank" rel="noopener noreferrer">this is where the jython extension adds its parser</a>. As for the sample extension, it adds its script <code>project-injection.js</code> and style <code>project-injection.css</code> into the <code>/project</code> page. If you <a href="http://127.0.0.1:3333/project" target="_blank" rel="noopener noreferrer">view the source of the /project page</a>, you will see references to those two files.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="wiring-up-the-extension">Wiring Up the Extension<a href="#wiring-up-the-extension" class="hash-link" aria-label="Direct link to Wiring Up the Extension" title="Direct link to Wiring Up the Extension">​</a></h3>
<p>The Extensions are loaded by the Butterfly framework. Butterfly refers to these as &#x27;modules&#x27;. <a href="https://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/WEB-INF/butterfly.properties#L27" target="_blank" rel="noopener noreferrer">The location of modules is set in the <code>main/webapp/butterfly.properties</code> file</a>. Butterfly simply descends into each of those paths and looks for any <code>MOD-INF</code> directories.</p>
<p>For more information, see <a href="https://github.com/OpenRefine/OpenRefine/wiki/Extension-Points" target="_blank" rel="noopener noreferrer">Extension Points</a>.</p>
<h2 class="anchor anchorWithStickyNavbar__YFU" id="extension-points">Extension points<a href="#extension-points" class="hash-link" aria-label="Direct link to Extension points" title="Direct link to Extension points">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="client-side-javascript-and-css">Client-side: Javascript and CSS<a href="#client-side-javascript-and-css" class="hash-link" aria-label="Direct link to Client-side: Javascript and CSS" title="Direct link to Client-side: Javascript and CSS">​</a></h3>
<p>The UI in OpenRefine for working with a project is coded in <a href="http://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/project.vt" target="_blank" rel="noopener noreferrer">the /main/webapp/modules/core/project.vt file</a>. The file is quite small, and that&#x27;s because almost all of its content is to be expanded dynamically through the Velocity variables <code>$scriptInjection</code> and <code>$styleInjection</code>. So that your own Javascript and CSS files get loaded, you need to register them with the ClientSideResourceManager, which is done in the /module/MOD-INF/controller.js file. See <a href="http://github.com/OpenRefine/OpenRefine/blob/master/extensions/sample/module/MOD-INF/controller.js" target="_blank" rel="noopener noreferrer">the controller.js file in this sample extension code</a> for an example.</p>
<p>In the registration call, the variable <code>module</code> is already available to your code by default, and it refers to your own extension.</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ClientSideResourceManager.addPaths(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;project/scripts&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        module,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;scripts/foo.js&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;scripts/subdir/bar.js&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can specify one or more files for registration, and their paths are relative to the <code>module</code> sub-directory of your extension. They are included in the order listed.</p>
<p>Javascript Bundling: Note that <code>project.vt</code> belongs to the core module and is thus under the control of the core module&#x27;s <a href="http://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/MOD-INF/controller.js" target="_blank" rel="noopener noreferrer">controller.js file</a>. The Javascript files to be included in <code>project.vt</code> are by default bundled together for performance. When debugging, you can prevent this bundling behavior by setting <code>bundle</code> to <code>false</code> near the top of that <code>controller.js</code> file. (If you have commit access to this code base, be sure not to check that change in.)</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="client-side-images">Client-side: Images<a href="#client-side-images" class="hash-link" aria-label="Direct link to Client-side: Images" title="Direct link to Client-side: Images">​</a></h3>
<p>We recommend that you always refer to images through your CSS files rather than in your Javascript code. URLs to images will thus be relative to your CSS files, e.g.,</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">.foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    background: url(../images/x.png);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you really really absolutely need to refer to your images in your Javascript code, then look up your extension&#x27;s URL path in the global Javascript variable <code>ModuleWirings</code>:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ModuleWirings[&quot;my-extension&quot;] + &quot;images/x.png&quot;</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="client-side-html-templates">Client-side: HTML Templates<a href="#client-side-html-templates" class="hash-link" aria-label="Direct link to Client-side: HTML Templates" title="Direct link to Client-side: HTML Templates">​</a></h3>
<p>Beside Javascript, CSS, and images, your extension might also include HTML templates that get loaded on the fly by your Javascript code and injected into the page&#x27;s DOM. For example, here is <a href="http://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/scripts/dialogs/clustering-dialog.html" target="_blank" rel="noopener noreferrer">the Cluster edit dialog template</a>, which gets loaded by code in <a href="http://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/scripts/dialogs/clustering-dialog.js" target="_blank" rel="noopener noreferrer">the equivalent javascript file &#x27;clustering-dialog.js&#x27;</a>:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var dialog = $(DOM.loadHTML(&quot;core&quot;, &quot;scripts/dialogs/clustering-dialog.html&quot;));</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>DOM.loadHTML</code> returns the content of the file as a string, and <code>$(...)</code> turns it into a DOM fragment. Where <code>&quot;core&quot;</code> is, you would want your extension&#x27;s name. The path of the HTML file is relative to your extension&#x27;s <code>module</code> sub-directory.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="client-side-project-ui-extension-points">Client-side: Project UI Extension Points<a href="#client-side-project-ui-extension-points" class="hash-link" aria-label="Direct link to Client-side: Project UI Extension Points" title="Direct link to Client-side: Project UI Extension Points">​</a></h3>
<p>Getting your extension&#x27;s Javascript code included in <code>project.vt</code> doesn&#x27;t accomplish much by itself unless your code also registers hooks into the UI. For example, you can surely implement an exporter in Javascript, but unless you add a corresponding menu command in the UI, your user can&#x27;t use your exporter.</p>
<h4 class="anchor anchorWithStickyNavbar__YFU" id="main-menu">Main Menu<a href="#main-menu" class="hash-link" aria-label="Direct link to Main Menu" title="Direct link to Main Menu">​</a></h4>
<p>The main menu can be extended by calling any one of the methods <code>MenuBar.appendTo</code>, <code>MenuBar.insertBefore</code>, and <code>MenuBar.insertAfter</code>. Each method takes 2 arguments: an array of strings that identify a particular existing menu item or submenu, and one new single menu item or submenu or an array of menu items and submenus. For example, to insert 2 menu items and a menu separator before the menu item Project &gt; Export Filtered Rows &gt; Templating..., write this Javascript code wherever that would execute when your Javascript files get loaded:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">MenuBar.insertBefore(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [&quot;core/project&quot;, &quot;core/export&quot;, &quot;core/export-templating&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;label&quot;:&quot;Menu item 1&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;click&quot;: function() { ... }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;label&quot;:&quot;Menu item 2&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;click&quot;: function() { ... }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {} // separator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The array <code>[&quot;core/project&quot;, &quot;core/export&quot;, &quot;core/export-templating&quot;]</code> pinpoints the reference menu item.</p>
<p>See the beginning of <a href="http://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/scripts/project/menu-bar.js" target="_blank" rel="noopener noreferrer">/main/webapp/modules/core/scripts/project/menu-bar.js</a> for IDs of menu items and submenus.</p>
<h4 class="anchor anchorWithStickyNavbar__YFU" id="column-header-menu">Column Header Menu<a href="#column-header-menu" class="hash-link" aria-label="Direct link to Column Header Menu" title="Direct link to Column Header Menu">​</a></h4>
<p>The drop-down menu of each column can also be extended, but the mechanism is slightly different compared to the main menu. Because the drop-down menu for a particular column is constructed on the fly when the user actually clicks the drop-down menu button, extending the column header menu can&#x27;t really be done once at start-up time, but must be done every time a column header menu gets created. So, registration in this case involves providing a function that gets called each such time:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DataTableColumnHeaderUI.extendMenu(function(column, columnHeaderUI, menu) { ... do stuff to menu ... });</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That function takes in the column object (which contains the column&#x27;s name), the column header UI object (generally not so useful), and the menu to extend. In the previous code line where it says &quot;do stuff to menu&quot;, you can write something like this:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">MenuSystem.appendTo(menu, [&quot;core/facet&quot;], [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            id: &quot;core/text-facet&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            label: &quot;My Facet on &quot; + column.name,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            click: function() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ... use column.name and do something ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]);</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In addition to <code>MenuSystem.appendTo</code>, you can also call <code>MenuSystem.insertBefore</code> and <code>MenuSystem.insertAfter</code> which the same 3 arguments. To see what IDs you can use, see the function <code>DataTableColumnHeaderUI.prototype._createMenuForColumnHeader</code> in <a href="http://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/scripts/views/data-table/column-header-ui.js" target="_blank" rel="noopener noreferrer">/main/webapp/modules/core/scripts/views/data-table/column-header-ui.js</a>.</p>
<h4 class="anchor anchorWithStickyNavbar__YFU" id="cell-renderers">Cell renderers<a href="#cell-renderers" class="hash-link" aria-label="Direct link to Cell renderers" title="Direct link to Cell renderers">​</a></h4>
<p>From OpenRefine 3.7 onwards, extensions can also customize the way cells are rendered. This is done by registering a renderer, which is responsible for transforming the JSON representation of a cell into DOM elements rendering it:</p>
<div class="language-js codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-js codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyCellRenderer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// some initialization code can be added here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rowIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the 0-based row index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cellIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the position of the column to which the cell belongs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cell</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the deserialized JSON representation of the cell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cellUI </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the parent CellUI object which called this renderer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// this renderer has the opportunity to return a DOM element represeting the cell, as follows:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;span&gt;rendered cell&lt;/span&gt;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// or it may not return anything, in which case the next cell renderer will be executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OpenRefine holds an ordered list of cell renderers in its <code>CellRendererRegistry</code>. To render a cell, OpenRefine will execute each cell renderer in order, until the first renderer which returns a DOM element. The following renderers are not executed and that DOM element is used as the cell representation.</p>
<p>The registration of the renderer is done with</p>
<div class="language-js codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-js codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token maybe-class-name">CellRendererRegistry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addRenderer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;my-renderer-identifier&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// a string identifying our new renderer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyCellRenderer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the renderer itself</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;recon&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the existing renderer it should be inserted before</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The default renderers available in OpenRefine itself can be found in <code>main/webapp/modules/core/scripts/views/data-table/cell-renderers/registry.js</code>.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="server-side-ajax-commands">Server-side: Ajax Commands<a href="#server-side-ajax-commands" class="hash-link" aria-label="Direct link to Server-side: Ajax Commands" title="Direct link to Server-side: Ajax Commands">​</a></h3>
<p>The client-side of OpenRefine gets things done by calling AJAX commands on the server-side. These commands must be registered with the OpenRefine servlet, so that the servlet knows how to route AJAX calls from the client-side. This can be done inside the <code>init</code> function in your extension&#x27;s <code>controller.js</code> file, e.g.,</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">function init() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      var RefineServlet = Packages.com.google.refine.RefineServlet;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      RefineServlet.registerCommand(module, &quot;my-command&quot;, new Packages.com.foo.bar.MyCommand());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Your command will then be accessible at <a href="http://127.0.0.1:3333/command/my-extension/my-command" target="_blank" rel="noopener noreferrer">http://127.0.0.1:3333/command/my-extension/my-command</a>.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="server-side-operations">Server-side: Operations<a href="#server-side-operations" class="hash-link" aria-label="Direct link to Server-side: Operations" title="Direct link to Server-side: Operations">​</a></h3>
<p>Most commands change the project&#x27;s data. Most of them do so by creating abstract operations. See the Changes, History, Processes, and Operations section of the <a href="https://github.com/OpenRefine/OpenRefine/wiki/Server-Side-Architecture" target="_blank" rel="noopener noreferrer">Server Side Architecture</a> document.</p>
<p>You can register an operation <strong>class</strong> in the <code>init</code> function as follows:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Packages.com.google.refine.operations.OperationRegistry.registerOperation(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      module, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;operation-name&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      Packages.com.foo.bar.MyOperation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  );</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Do not call <code>new</code> to construct an operation instance. You must register the class itself. The class should have a static function for reconstructing an operation instance from a JSON blob:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">static public AbstractOperation reconstruct(Project project, JSONObject obj) throws Exception {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="server-side-grel">Server-side: GREL<a href="#server-side-grel" class="hash-link" aria-label="Direct link to Server-side: GREL" title="Direct link to Server-side: GREL">​</a></h3>
<p>GREL can be extended with new functions. This is also done in the <code>init</code> function in <code>controller.js</code>, e.g.,</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Packages.com.google.refine.grel.ControlFunctionRegistry.registerFunction(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;functionName&quot;, new Packages.com.foo.bar.TheFunctionClass());</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You might also want to provide new variables (beyond just <code>value</code>, <code>cells</code>, <code>row</code>, etc.) available to expressions. This is done by registering a binder that implements the interface <code>com.google.refine.expr.Binder</code>:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Packages.com.google.refine.expr.ExpressionUtils.registerBinder(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        new Packages.com.foo.bar.MyBinder());</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="server-side-importers">Server-side: Importers<a href="#server-side-importers" class="hash-link" aria-label="Direct link to Server-side: Importers" title="Direct link to Server-side: Importers">​</a></h3>
<p>You can register an importer as follows:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Packages.com.google.refine.importers.ImporterRegistry.registerImporter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;importer-name&quot;, new Packages.com.foo.bar.MyImporter());</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The string <code>&quot;importer-name&quot;</code> isn&#x27;t important at all. It&#x27;s not really related to file extension or mime-type. Just use something unique. Your importer will be explicitly called to test if it can import something.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="server-side-exporters">Server-side: Exporters<a href="#server-side-exporters" class="hash-link" aria-label="Direct link to Server-side: Exporters" title="Direct link to Server-side: Exporters">​</a></h3>
<p>You can register an exporter as follows:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Packages.com.google.refine.exporters.ExporterRegistry.registerExporter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;exporter-name&quot;, new Packages.com.foo.bar.MyExporter());</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The string <code>&quot;exporter-name&quot;</code> isn&#x27;t important at all. It&#x27;s only used by the client-side to tell the server-side which exporter to use. Just use something unique and, of course, relevant.</p>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="server-side-overlay-models">Server-side: Overlay Models<a href="#server-side-overlay-models" class="hash-link" aria-label="Direct link to Server-side: Overlay Models" title="Direct link to Server-side: Overlay Models">​</a></h3>
<p>Overlay models are objects attached onto a core Project object to store and manage additional data for that project. For example, the schema alignment skeleton is managed by the Protograph overlay model. An overlay model implements the interface <code>com.google.refine.model.OverlayModel</code> and can be registered like so:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Packages.com.google.refine.model.Project.registerOverlayModel(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;model-name&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      Packages.com.foo.bar.MyOverlayModel);</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that you register the <strong>class</strong> , not an instance. The class should implement the following static method for reconstructing an overlay model instance from a JSON blob:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">static public OverlayModel reconstruct(JSONObject o) throws JSONException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the project gets saved, the overlay model instance&#x27;s <code>write</code> method will be called:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public void write(JSONWriter writer, Properties options) throws JSONException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar__YFU" id="server-side-scripting-languages">Server-side: Scripting Languages<a href="#server-side-scripting-languages" class="hash-link" aria-label="Direct link to Server-side: Scripting Languages" title="Direct link to Server-side: Scripting Languages">​</a></h3>
<p>A scripting language (such as Jython) can be registered as follows:</p>
<div class="codeBlockContainer_WtFl theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_pLfi"><pre tabindex="0" class="prism-code language-text codeBlock__6v4 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Ofhx"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Packages.com.google.refine.expr.MetaParser.registerLanguageParser(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;jython&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;Jython&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Packages.com.google.refine.jython.JythonEvaluable.createParser(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;return value&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span><br></span></code></pre><div class="buttonGroup_TdkF"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_x2pO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_M8dX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Dndh"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first string is the prefix that gets prepended to each expression so that we know which language the expression is in. This should be short, unique, and identifying. The second string is a user-friendly name of the language. The third is an object that implements the interface <code>com.google.refine.expr.LanguageSpecificParser</code>. The final string is the default expression in that language that would return the cell&#x27;s value.</p>
<p>In 2018 we are making important changes to OpenRefine to modernize it, for the benefit of users and contributors. This page describes the changes that impact developers of extensions or forks and is intended to minimize the effort required on their end to follow the transition. The instructions are written specifically with extension maintainers in mind, but fork maintainers should also find it useful.</p>
<p>This document describes the migrations in the order they are committed to the master branch. This means that it should be possible to perform each migration in turn, with the ability to run the software between each stage by checking out the appropriate git commit.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/OpenRefine/openrefine.github.com/edit/master/docs/technical-reference/writing-extensions.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_AKM5" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_v_5u"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-02-03T15:00:46.000Z" itemprop="dateModified">Feb 3, 2023</time></b> by <b>Antonin Delpeuch</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/technical-reference/reconciliation-api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Reconciliation API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/technical-reference/migrating-older-extensions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrating older extensions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_kigY thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#directory-layout" class="table-of-contents__link toc-highlight">Directory Layout</a></li></ul></li><li><a href="#sample-extension" class="table-of-contents__link toc-highlight">Sample extension</a><ul><li><a href="#basic-structure" class="table-of-contents__link toc-highlight">Basic Structure</a></li><li><a href="#wiring-up-the-extension" class="table-of-contents__link toc-highlight">Wiring Up the Extension</a></li></ul></li><li><a href="#extension-points" class="table-of-contents__link toc-highlight">Extension points</a><ul><li><a href="#client-side-javascript-and-css" class="table-of-contents__link toc-highlight">Client-side: Javascript and CSS</a></li><li><a href="#client-side-images" class="table-of-contents__link toc-highlight">Client-side: Images</a></li><li><a href="#client-side-html-templates" class="table-of-contents__link toc-highlight">Client-side: HTML Templates</a></li><li><a href="#client-side-project-ui-extension-points" class="table-of-contents__link toc-highlight">Client-side: Project UI Extension Points</a></li><li><a href="#server-side-ajax-commands" class="table-of-contents__link toc-highlight">Server-side: Ajax Commands</a></li><li><a href="#server-side-operations" class="table-of-contents__link toc-highlight">Server-side: Operations</a></li><li><a href="#server-side-grel" class="table-of-contents__link toc-highlight">Server-side: GREL</a></li><li><a href="#server-side-importers" class="table-of-contents__link toc-highlight">Server-side: Importers</a></li><li><a href="#server-side-exporters" class="table-of-contents__link toc-highlight">Server-side: Exporters</a></li><li><a href="#server-side-overlay-models" class="table-of-contents__link toc-highlight">Server-side: Overlay Models</a></li><li><a href="#server-side-scripting-languages" class="table-of-contents__link toc-highlight">Server-side: Scripting Languages</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Get OpenRefine</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/whats_new">What&#x27;s new</a></li><li class="footer__item"><a class="footer__link-item" href="/extensions">Extensions</a></li><li class="footer__item"><a class="footer__link-item" href="/distributions">Other distributions</a></li><li class="footer__item"><a href="https://github.com/OpenRefine/OpenRefine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RpKI"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">User manual</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/technical-reference/contributing">Contributing</a></li><li class="footer__item"><a class="footer__link-item" href="/external_resources">External resources</a></li><li class="footer__item"><a class="footer__link-item" href="/funding">Grants &amp; funding</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy">Privacy notice</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community">Get involved</a></li><li class="footer__item"><a href="https://forum.openrefine.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RpKI"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitter.im/OpenRefine/OpenRefine" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter chat<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RpKI"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/openrefine" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RpKI"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                  <a rel="me" class="footer__link-item" target="_blank" href="https://fosstodon.org/@OpenRefine">Mastodon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_node_modules-@docusaurus-theme-classic-lib-theme-Icon-ExternalLink-styles-module"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://openrefine.org" rel="noopener noreferrer" class="footerLogoLink_rbIq"><img src="/img/openrefine_logo.svg" alt="OpenRefine diamond logo" class="footer__logo themedComponent_vVmS themedComponent--light_NniB" height="150"><img src="/img/openrefine_logo.svg" alt="OpenRefine diamond logo" class="footer__logo themedComponent_vVmS themedComponent--dark_yJur" height="150"></a></div><div class="footer__copyright"><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png"></a><br>OpenRefine's documentation is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</div></div></div></footer></div>
</body>
</html>